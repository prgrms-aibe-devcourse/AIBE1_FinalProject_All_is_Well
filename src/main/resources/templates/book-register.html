<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>중고책 판매 등록 - 북적북적</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body class="relative flex min-h-screen flex-col bg-white" style="font-family: 'Plus Jakarta Sans', 'Noto Sans', sans-serif;">
<div class="flex flex-col grow layout-container">
    <!-- 헤더 프래그먼트 포함 -->
    <div th:replace="~{fragments/header :: header}"></div>

    <main class="flex-1 flex justify-center px-6 md:px-40 py-6">
        <div class="w-full max-w-[960px] flex flex-col">
            <!--
              [핵심 수정]
              폼의 제출 경로(action)를 페이지 이동을 처리할 수 있는 BookPageController의 '/used-books'로 설정합니다.
              enctype="multipart/form-data"는 파일(이미지) 업로드를 위해 반드시 필요합니다.
            -->
            <form th:action="@{/used-books}" th:object="${bookRequest}" method="post" enctype="multipart/form-data" class="space-y-12">

                <section>
                    <h1 class="text-[32px] font-bold text-[#111418] mb-2">중고책 판매 등록</h1>
                    <p class="text-base text-gray-600">판매하실 중고책의 정보를 입력해주세요.</p>
                </section>

                <!-- ISBN 검색 섹션 -->
                <div class="border-b border-gray-900/10 pb-12">
                    <h2 class="text-base font-semibold leading-7 text-gray-900">ISBN으로 책 정보 자동 완성</h2>
                    <p class="mt-1 text-sm leading-6 text-gray-600">ISBN을 입력하고 검색 버튼을 누르면 책 정보가 자동으로 입력됩니다.</p>
                    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                        <div class="sm:col-span-4">
                            <label for="isbn" class="block text-sm font-medium leading-6 text-gray-900">ISBN</label>
                            <div class="mt-2 flex rounded-md shadow-sm">
                                <input type="text" id="isbn-input" th:field="*{isbn}" class="block w-full flex-1 rounded-none rounded-l-md border-0 py-1.5 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="'-' 없이 숫자만 입력하세요">
                                <button type="button" id="isbn-search-btn" class="relative -ml-px inline-flex items-center gap-x-1.5 rounded-r-md px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50">ISBN 검색</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 책 정보 입력 섹션 -->
                <div class="border-b border-gray-900/10 pb-12">
                    <h2 class="text-base font-semibold leading-7 text-gray-900">책 정보</h2>
                    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                        <div class="sm:col-span-4">
                            <label for="title" class="block text-sm font-medium leading-6 text-gray-900">제목</label>
                            <input type="text" id="title" th:field="*{title}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <div class="sm:col-span-3">
                            <label for="author" class="block text-sm font-medium leading-6 text-gray-900">저자</label>
                            <input type="text" id="author" th:field="*{author}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <div class="sm:col-span-3">
                            <label for="publisher" class="block text-sm font-medium leading-6 text-gray-900">출판사</label>
                            <input type="text" id="publisher" th:field="*{publisher}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <div class="sm:col-span-2">
                            <label for="publicationYear" class="block text-sm font-medium leading-6 text-gray-900">출판년도</label>
                            <input type="number" id="publicationYear" th:field="*{publicationYear}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <div class="sm:col-span-4">
                            <label for="categoryId" class="block text-sm font-medium leading-6 text-gray-900">카테고리</label>
                            <select id="categoryId" th:field="*{categoryId}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6">
                                <option value="">카테고리를 선택하세요</option>
                                <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"></option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 판매 정보 입력 섹션 -->
                <div class="border-b border-gray-900/10 pb-12">
                    <h2 class="text-base font-semibold leading-7 text-gray-900">판매 정보</h2>
                    <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                        <div class="sm:col-span-2">
                            <label for="sellingPrice" class="block text-sm font-medium leading-6 text-gray-900">판매 가격 (원)</label>
                            <input type="number" id="sellingPrice" th:field="*{sellingPrice}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                        </div>
                        <div class="sm:col-span-2">
                            <label for="conditionGrade" class="block text-sm font-medium leading-6 text-gray-900">책 상태</label>
                            <select id="conditionGrade" th:field="*{conditionGrade}" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                                <option value="최상">최상</option>
                                <option value="상">상</option>
                                <option value="중">중</option>
                                <option value="하">하</option>
                            </select>
                        </div>
                        <div class="col-span-full">
                            <label for="detailedCondition" class="block text-sm font-medium leading-6 text-gray-900">상세 설명</label>
                            <textarea id="detailedCondition" th:field="*{detailedCondition}" rows="3" class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" placeholder="책의 상태에 대해 자세히 설명해주세요. (예: 밑줄 흔적, 겉표지 흠집 등)"></textarea>
                        </div>
                        <div class="col-span-full">
                            <label for="images" class="block text-sm font-medium leading-6 text-gray-900">책 사진</label>
                            <div class="mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10">
                                <div class="text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" />
                                    </svg>
                                    <div class="mt-4 flex text-sm leading-6 text-gray-600">
                                        <label for="images" class="relative cursor-pointer rounded-md bg-white font-semibold text-indigo-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-indigo-600 focus-within:ring-offset-2 hover:text-indigo-500">
                                            <span>파일 업로드</span>
                                            <input id="images" name="images" type="file" class="sr-only" multiple>
                                        </label>
                                        <p class="pl-1">또는 드래그 앤 드롭</p>
                                    </div>
                                    <p id="image-list" class="mt-2 text-sm text-gray-600"></p>
                                    <p class="text-xs leading-5 text-gray-600">PNG, JPG, GIF up to 10MB</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 제출 버튼 -->
                <div class="mt-6 flex items-center justify-end gap-x-6">
                    <button type="button" class="text-sm font-semibold leading-6 text-gray-900">취소</button>
                    <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">판매 등록하기</button>
                </div>
            </form>
        </div>
    </main>

    <!-- 푸터 프래그먼트 포함 -->
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>

<script>
document.getElementById('isbn-search-btn').addEventListener('click', function() {
        const isbn = document.getElementById('isbn-input').value;
        if (!isbn) {
            alert('ISBN을 입력해주세요.');
            return;
        }

        // BookPageController에 있는 ISBN 조회 API를 호출합니다.
        fetch(`/used-books/isbn/${isbn}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('해당 ISBN의 책 정보를 찾을 수 없습니다.');
                }
                return response.json();
            })
            .then(data => {
                // API 응답으로 받은 데이터로 폼을 채웁니다.
                document.getElementById('title').value = data.title || '';
                document.getElementById('author').value = data.author || '';
                document.getElementById('publisher').value = data.publisher || '';
                document.getElementById('publicationYear').value = data.publicationYear || '';
            })
            .catch(error => {
                alert(error.message);
                console.error('Error fetching book info:', error);
    });
    const fileInput = document.getElementById('images');
    const listEl = document.getElementById('image-list');
    fileInput.addEventListener('change', () => {
        const names = Array.from(fileInput.files).map(f => f.name).join(', ');
        listEl.textContent = names || '선택된 파일 없음';
    });
});
</script>
</body>
</html>